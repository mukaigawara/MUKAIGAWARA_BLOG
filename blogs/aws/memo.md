# aws memo

## Principal エレメントとは？

GPT より

> AWS の「Principal（プリンシパル）」エレメントは、IAM（Identity and Access Management）ポリシーやリソースベースのポリシーにおいて、アクセスを許可または拒否する対象のエンティティ（ユーザー、グループ、ロール、サービスなど）を指定するために使用されます。
>
> 具体的には、次のような対象がプリンシパルとして指定されます：
>
> AWS アカウント（ID） - 他の AWS アカウントからのアクセスを許可する場合に指定します。
> IAM ユーザー - 特定の IAM ユーザーに対するアクセスを制御します。
> IAM ロール - 他のサービスやアカウントにアクセス権限を与える際に使用されます。
> サービスプリンシパル - AWS のサービス（例：EC2、Lambda など）に関連付けられたプリンシパル。
> フェデレーションプリンシパル - SAML や OpenID Connect などの外部 ID プロバイダーから認証されたユーザー。
> IAM ポリシーで Principal を指定することで、ポリシーが適用される対象（プリンシパル）を制限できます。例えば、S3 バケットポリシーでアクセスを許可するプリンシパルを指定することができます。

**要は、Principal エレメントで指定できるのは、AWS の IAM ユーザー、アカウント、サービスである。**

## S3 のファイルの署名付き URL とは？

> S3 の署名付き URL は、Amazon S3（Simple Storage Service）内のファイルに対して一時的なアクセス権限を付与するための URL です。
> 署名付き URL を使用することで、パブリックアクセスができないバケット内のファイルに対してセキュアにアクセスすることが可能です。
>
> 具体的には、生成した URL には署名が含まれており、その URL を利用することでアクセスが可能になります。その署名は AWS アカウントの認証情報に基づいて生成されるため、認証情報がない場合は署名付き URL を作成できず、ファイルへのアクセスもできません。そして、これらの URL は指定された期間内にのみ有効です。期限を過ぎればアクセスはできなくなるため、必要な時にのみ発行・使用することができます。

要は、期限付きの公開 url を作れるよ　的な

### バケットポリシー

- Principal を指定せずに、ユーザーポリシーにアクセス許可をアタッチする制御も可能。
- Resource にバケットのみが指定されていると、オブジェクトにはアタッチできないので、`<バケット名>/*`とする
  - 例: `<バケット名>/` → `<バケット名>/*`
- ACL では IAM ユーザーを指定してアクセス制限はできない。

### エフェメラルポート

使用用途が決まっていないポートのこと

### セキュリティグループ

- ファイアウォール。
- EC2 や RDS などの AWS リソースに関連づける。
- 受信と送信の両方をリソースレベルで制限できる。
- ルール変更後、直ちに EC2 などに反映される。
- リソースをグループ化し、共通のセキュリティグループを関連づけられる。

- **許可されたインバウンドルールに対する応答にはアウトバンドルールを設定する必要はない。**
- ステートフルってどゆこと？

  > セキュリティグループがステートフルであるということは、インバウンド（受信）トラフィックに対するアウトバウンド（送信）トラフィックが自動的に許可されることを意味します。具体的には、セキュリティグループで許可されたインバウンドトラフィックに対する応答トラフィックは、アウトバウンドルールを明示的に設定しなくても許可されます。
  >
  > 例えば、セキュリティグループでポート 80（HTTP）へのインバウンドトラフィックを許可した場合、そのトラフィックに対する応答（レスポンス）はアウトバウンドルールを設定しなくても自動的に許可されます。これにより、通信がスムーズに行われるようになります。

:::warning 特定のアクセスをブロック
セキュリティーグループは許可設定しかできないので、特定のアクセスをブロックしたいなら、ネットワーク ACL を使う。
:::

### ネットワーク ACL

- サブネットに関連づけられ、受信と送信の両方をサブネットレベルで制御できる。
- 関連づけられたすべてのサブネットに適用されるので、セキュリティグループよりも広範囲な制御が可能。
- **ステートレスなので、応答通信にも許可の設定が必要**

- ルール番号がアスタリスクのデフォルトルールを変更・削除することはできない。

### IAM

```JSON
~~~
"Conditon" : {
    "ForAnyValue:IpAdress":{
        "aws:SourceIp" : [
            "135.101.0.0/16"
        ]
    }
}
```

- こういうポリシーの時、ip はプライベート IP アドレスではなく、**グローバル IP アドレス**である。
- また、Deny は優先される。
- すべての AWS アカウントに対して制限がある
- 管理ポリシーの上限は 10 で、申請で 20 に上げれる。(上限があるよ)
